# Gamelan Memory Executor - Getting Started Guide

## üöÄ Quick Start (5 Minutes)

### Prerequisites
- Java 21 or later
- Maven 3.9+
- Docker & Docker Compose (optional, for PostgreSQL)

### Step 1: Build the Project

```bash
cd gamelan-memory-executor
mvn clean package -DskipTests
```

### Step 2: Start with In-Memory Store (No Database Required)

```bash
# Run in dev mode with hot reload
mvn quarkus:dev
```

The application will start on port 8081.

### Step 3: Verify Installation

```bash
# Check health
curl http://localhost:8081/health/live

# Expected response:
# {"status":"UP","checks":[]}
```

### Step 4: Test the API

```bash
# Store a memory
curl -X POST http://localhost:8081/api/memory/store \
  -H "Content-Type: application/json" \
  -d '{
    "namespace": "test",
    "content": "Customer reported damaged product and requested refund",
    "type": "EPISODIC",
    "importance": 0.8
  }'

# Search for similar memories
curl -X POST http://localhost:8081/api/memory/search \
  -H "Content-Type: application/json" \
  -d '{
    "namespace": "test",
    "query": "product quality issue",
    "limit": 5
  }'

# Build context
curl -X POST http://localhost:8081/api/memory/context \
  -H "Content-Type: application/json" \
  -d '{
    "namespace": "test",
    "query": "How to handle refund requests?",
    "maxMemories": 3,
    "systemPrompt": "You are a support assistant"
  }'

# Get statistics
curl http://localhost:8081/api/memory/stats/test
```

## üêò Production Setup with PostgreSQL

### Step 1: Start PostgreSQL with pgvector

```bash
# Using Docker Compose (recommended)
docker-compose up -d postgres

# Or manually
docker run -d \
  --name gamelan-postgres \
  -e POSTGRES_DB=gamelan_memory \
  -e POSTGRES_USER=gamelan \
  -e POSTGRES_PASSWORD=gamelan \
  -p 5432:5432 \
  pgvector/pgvector:pg16
```

### Step 2: Initialize Database

```bash
# The database is automatically initialized on startup
# Or run manually:
docker exec -i gamelan-postgres psql -U gamelan -d gamelan_memory < init-db.sql
```

### Step 3: Configure Application

Edit `src/main/resources/application.properties`:

```properties
# Change to PostgreSQL
gamelan.memory.store.type=postgres

# Database connection (already configured)
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=gamelan
quarkus.datasource.password=gamelan
quarkus.datasource.reactive.url=postgresql://localhost:5432/gamelan_memory
```

### Step 4: Run with PostgreSQL

```bash
mvn quarkus:dev
```

## üîë OpenAI Integration (Optional)

### Step 1: Configure OpenAI

Edit `application.properties`:

```properties
gamelan.embedding.provider=openai
gamelan.embedding.openai.api-key=sk-your-api-key-here
gamelan.embedding.openai.model=text-embedding-3-small
```

### Step 2: Test OpenAI Embeddings

```bash
# Store memory with OpenAI embeddings
curl -X POST http://localhost:8081/api/memory/store \
  -H "Content-Type: application/json" \
  -d '{
    "content": "High-quality semantic embedding test",
    "namespace": "openai-test"
  }'
```

## üê≥ Docker Deployment

### Build Docker Image

```bash
docker build -t gamelan-memory-executor:1.0.0 .
```

### Run with Docker Compose

```bash
# Start all services
docker-compose up -d

# View logs
docker-compose logs -f memory-executor

# Stop services
docker-compose down
```

## üìä Verify Installation

Run the verification script:

```bash
#!/bin/bash

echo "=== Gamelan Memory Executor Verification ==="

# Check if service is running
if curl -sf http://localhost:8081/health/live > /dev/null; then
    echo "‚úÖ Service is running"
else
    echo "‚ùå Service is not running"
    exit 1
fi

# Store test memory
STORE_RESPONSE=$(curl -s -X POST http://localhost:8081/api/memory/store \
  -H "Content-Type: application/json" \
  -d '{
    "namespace": "verify",
    "content": "Test memory for verification",
    "importance": 0.9
  }')

if echo "$STORE_RESPONSE" | grep -q "success.*true"; then
    echo "‚úÖ Memory storage working"
    MEMORY_ID=$(echo "$STORE_RESPONSE" | grep -o '"memoryId":"[^"]*"' | cut -d'"' -f4)
    echo "   Memory ID: $MEMORY_ID"
else
    echo "‚ùå Memory storage failed"
    echo "   Response: $STORE_RESPONSE"
    exit 1
fi

# Search test
SEARCH_RESPONSE=$(curl -s -X POST http://localhost:8081/api/memory/search \
  -H "Content-Type: application/json" \
  -d '{
    "namespace": "verify",
    "query": "verification test",
    "limit": 1
  }')

if echo "$SEARCH_RESPONSE" | grep -q "success.*true"; then
    echo "‚úÖ Memory search working"
    RESULT_COUNT=$(echo "$SEARCH_RESPONSE" | grep -o '"count":[0-9]*' | cut -d':' -f2)
    echo "   Results found: $RESULT_COUNT"
else
    echo "‚ùå Memory search failed"
    exit 1
fi

# Context building test
CONTEXT_RESPONSE=$(curl -s -X POST http://localhost:8081/api/memory/context \
  -H "Content-Type: application/json" \
  -d '{
    "namespace": "verify",
    "query": "Test query for context",
    "maxMemories": 3
  }')

if echo "$CONTEXT_RESPONSE" | grep -q "success.*true"; then
    echo "‚úÖ Context engineering working"
    TOKENS=$(echo "$CONTEXT_RESPONSE" | grep -o '"totalTokens":[0-9]*' | cut -d':' -f2)
    echo "   Total tokens: $TOKENS"
else
    echo "‚ùå Context engineering failed"
    exit 1
fi

# Statistics test
STATS_RESPONSE=$(curl -s http://localhost:8081/api/memory/stats/verify)

if echo "$STATS_RESPONSE" | grep -q "success.*true"; then
    echo "‚úÖ Statistics retrieval working"
    TOTAL=$(echo "$STATS_RESPONSE" | grep -o '"totalMemories":[0-9]*' | cut -d':' -f2)
    echo "   Total memories: $TOTAL"
else
    echo "‚ùå Statistics retrieval failed"
    exit 1
fi

echo ""
echo "=== All Verification Tests Passed ‚úÖ ==="
echo ""
echo "Next steps:"
echo "1. Try the examples: curl http://localhost:8081/api/memory/examples/run"
echo "2. View metrics: curl http://localhost:8081/metrics"
echo "3. Check docs: cat README.md"
```

Save as `verify.sh` and run:

```bash
chmod +x verify.sh
./verify.sh
```

## üß™ Running Tests

```bash
# Run all tests
mvn test

# Run specific test
mvn test -Dtest=MemoryExecutorTest

# Run with code coverage
mvn clean verify
```

## üìä Monitoring

### View Metrics

```bash
# Prometheus metrics
curl http://localhost:8081/metrics

# Health checks
curl http://localhost:8081/health/live
curl http://localhost:8081/health/ready
```

### Grafana Dashboard (if monitoring profile enabled)

```bash
# Start with monitoring
docker-compose --profile monitoring up -d

# Access Grafana
open http://localhost:3000
# Username: admin
# Password: admin
```

## üîß Troubleshooting

### Service won't start

```bash
# Check Java version
java -version  # Should be 21+

# Check port availability
lsof -i :8081

# View logs
docker-compose logs memory-executor
```

### PostgreSQL connection issues

```bash
# Check PostgreSQL is running
docker ps | grep postgres

# Test connection
docker exec gamelan-postgres psql -U gamelan -d gamelan_memory -c "SELECT 1"

# Check pgvector extension
docker exec gamelan-postgres psql -U gamelan -d gamelan_memory -c "SELECT * FROM pg_extension WHERE extname='vector'"
```

### Memory search returns empty

```bash
# Verify memories are stored
curl http://localhost:8081/api/memory/stats/your-namespace

# Check similarity threshold (lower it)
curl -X POST http://localhost:8081/api/memory/search \
  -d '{"query":"test","minSimilarity":0.0}'
```

## üìö Next Steps

1. **Read the Documentation**
   - [README.md](README.md) - Comprehensive guide
   - [ARCHITECTURE.md](ARCHITECTURE.md) - Technical details

2. **Explore Examples**
   - See `src/main/java/tech/kayys/gamelan/executor/memory/examples/`
   - Run examples via API or programmatically

3. **Integrate with Workflows**
   - Use `MemoryAwareExecutor` in your workflows
   - Configure memory namespaces per workflow
   - Set up consolidation tasks

4. **Production Checklist**
   - [ ] Configure PostgreSQL with replication
   - [ ] Set up monitoring and alerts
   - [ ] Configure API keys securely
   - [ ] Enable HTTPS/TLS
   - [ ] Set up backup strategy
   - [ ] Configure resource limits
   - [ ] Set up log aggregation

## üÜò Support

- Issues: Create a GitHub issue
- Documentation: See README.md and ARCHITECTURE.md
- Examples: Check examples directory

---

**Happy Memory-Aware Workflow Execution! üß†üöÄ**


