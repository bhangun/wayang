# Wayang Standalone Runtime Configuration
# This configuration file sets up all components for standalone operation
# Force this config source to override transitive application.properties from dependencies.
config_ordinal=1000

# Quarkus Application Configuration
quarkus.application.name=wayang-standalone
quarkus.application.version=1.0.0

# HTTP Server Configuration
quarkus.http.port=8080
quarkus.http.root-path=/
quarkus.http.non-application-root-path=/q
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,X-Requested-With,accept,Origin,Access-Control-Request-Method,Access-Control-Request-Headers

# Hibernate ORM Configuration
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.database.charset=UTF-8
quarkus.hibernate-orm.mapping.format.global=ignore
quarkus.hibernate-orm.schema-management.strategy=drop-and-create
quarkus.hibernate-orm.sql-load-script=no-file
quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect

# Global standalone datasource defaults (always active)
quarkus.datasource.db-kind=h2
quarkus.datasource.username=sa
quarkus.datasource.password=
quarkus.datasource.jdbc.url=jdbc:h2:mem:wayangdb;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
quarkus.datasource.jdbc.driver=org.h2.Driver
quarkus.datasource.reactive=false

# Community Mode (default): Embedded H2 in PostgreSQL compatibility mode
%community.quarkus.datasource.db-kind=h2
%community.quarkus.datasource.username=sa
%community.quarkus.datasource.password=
%community.quarkus.datasource.jdbc.url=jdbc:h2:mem:wayangdb;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
%community.quarkus.datasource.jdbc.driver=org.h2.Driver
%community.quarkus.hibernate-orm.schema-management.strategy=drop-and-create
%community.quarkus.hibernate-orm.sql-load-script=no-file
%community.quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect

# Enterprise Mode: External PostgreSQL, cloud-native lifecycle
%enterprise.quarkus.datasource.db-kind=postgresql
%enterprise.quarkus.datasource.username=${WAYANG_DB_USERNAME:wayang}
%enterprise.quarkus.datasource.password=${WAYANG_DB_PASSWORD:wayang}
%enterprise.quarkus.datasource.jdbc.url=${WAYANG_DB_JDBC_URL:jdbc:postgresql://localhost:5432/wayang}
%enterprise.quarkus.hibernate-orm.schema-management.strategy=validate
%enterprise.quarkus.hibernate-orm.sql-load-script=no-file
%enterprise.quarkus.hibernate-orm.dialect=org.hibernate.dialect.PostgreSQLDialect

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."tech.kayys".level=DEBUG
quarkus.log.category."io.quarkus".level=WARN
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# Health Checks
quarkus.smallrye-health.root-path=/health
quarkus.smallrye-health.ui.always-expose-details=true

# OpenAPI and Swagger UI
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=swagger-ui
quarkus.smallrye-openapi.path=openapi

# Metrics
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics

# Baseline defaults (always available even when no profile is active)
quarkus.profile=community
wayang.multitenancy.enabled=true
gamelan.tenant.default-id=community
gamelan.tenant.allow-default=true

# Multitenancy and tenant defaults by mode
%community.wayang.multitenancy.enabled=true
%community.gamelan.tenant.default-id=community
%community.gamelan.tenant.allow-default=true
%enterprise.wayang.multitenancy.enabled=false
%enterprise.gamelan.tenant.default-id=enterprise-default
%enterprise.gamelan.tenant.allow-default=false

# Plugin Configuration
wayang.plugins.auto-discovery=true
wayang.plugins.scan-packages=tech.kayys.wayang
wayang.plugins.directory=plugins

# Schema Validation Configuration
wayang.schema.validation.enabled=true
wayang.schema.cache-enabled=true
wayang.schema.cache-size=100

# Embedded State Store Configuration (using in-memory solution for standalone)
# For workflow execution state, we use an embedded solution
wayang.state-store.type=embedded
wayang.state-store.embedded.backend=memory
gamelan.registry.persistence.type=memory

# Gamelan Orchestration Configuration
gamelan.orchestration.mode=embedded
gamelan.state-management.backend=embedded
gamelan.execution.timeout=300S
gamelan.execution.max-concurrent-runs=10

# Inference Engine Configuration
gollek.inference.local.enabled=true
gollek.inference.default-provider=local
gollek.inference.streaming.enabled=true
gollek.inference.batch-processing.enabled=true

# Model Configuration
gollek.models.default-timeout=60S
gollek.models.max-input-tokens=4096
gollek.models.max-output-tokens=2048

# Vault/Secrets Configuration (embedded for standalone)
wayang.vault.type=embedded
wayang.vault.embedded.location=secrets.dat
wayang.vault.encryption.enabled=false

# Cache Configuration
quarkus.cache.type=caffeine
quarkus.cache.caffeine."schemas".initial-capacity=10
quarkus.cache.caffeine."schemas".maximum-size=100
quarkus.cache.caffeine."schemas".expire-after-write=10M
# Required by transitive cache metadata; standalone still uses in-memory scheduler/repositories.
quarkus.cache.redis.executors.value-type=java.lang.String
quarkus.redis.health.enabled=false

# Thread Pool Configuration
quarkus.thread-pool.core-threads=8
quarkus.thread-pool.max-threads=200
quarkus.thread-pool.queue-size=1000

# Security Configuration (minimal for standalone)
quarkus.security.users.embedded.enabled=false
quarkus.keycloak.admin.username=admin
quarkus.keycloak.admin.password=admin

# Exclude transitive Gamelan infrastructure beans not available in standalone mode
quarkus.arc.exclude-types=tech.kayys.gamelan.kafka.**,tech.kayys.gamelan.grpc.**,tech.kayys.gamelan.core.orchestration.**,tech.kayys.gamelan.config.**,tech.kayys.gamelan.scheduler.DefaultWorkflowScheduler,tech.kayys.gamelan.registry.cache.ExecutorCacheManager,tech.kayys.gollek.sdk.local.**,tech.kayys.golek.sdk.local.**,tech.kayys.gollek.api.rest.HealthResource

# Ensure REST resources from dependency modules are indexed in uber-jar mode
quarkus.index-dependency.gamelan-runtime-core.group-id=tech.kayys.gamelan
quarkus.index-dependency.gamelan-runtime-core.artifact-id=gamelan-runtime-core
quarkus.index-dependency.gollek-api-rest.group-id=tech.kayys.gollek
quarkus.index-dependency.gollek-api-rest.artifact-id=gollek-api-rest

# CORS Configuration
