# Hibernate ORM Configuration
#quarkus.hibernate-orm.mapping.format.global=ignore


# -----------------------------------------------------------------
# Core Quarkus configuration
# -----------------------------------------------------------------
quarkus.application.name=wayang-designer-backend
quarkus.application.version=1.0.0

# -----------------------------------------------------------------
# Hibernate ORM (Panache Reactive) – dev profile uses drop‑and‑create
# -----------------------------------------------------------------
quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.sql-load-script=no-file
quarkus.hibernate-orm.mapping.format.global=ignore

# -----------------------------------------------------------------
# Datasource – PostgreSQL (reactive)
# -----------------------------------------------------------------
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USERNAME:wayang}
quarkus.datasource.password=${DB_PASSWORD:dev123}
quarkus.datasource.reactive.url=postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:wayang_designer_dev}
quarkus.datasource.reactive.max-size=20

# -----------------------------------------------------------------
# Redis cache
# -----------------------------------------------------------------
quarkus.redis.hosts=redis://${REDIS_HOST:localhost}:${REDIS_PORT:6379}
quarkus.redis.password=${REDIS_PASSWORD:}
quarkus.redis.client-type=standalone

# -----------------------------------------------------------------
# OpenAPI / Swagger UI
# -----------------------------------------------------------------
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui
quarkus.swagger-ui.theme=material
quarkus.smallrye-openapi.info-title=Wayang Designer Backend API
quarkus.smallrye-openapi.info-version=${quarkus.application.version}
quarkus.smallrye-openapi.info-description=REST API for the Wayang visual AI workflow designer
quarkus.smallrye-openapi.security-scheme=jwt
quarkus.smallrye-openapi.security-scheme-name=JWT Authentication
quarkus.smallrye-openapi.security-scheme-description=JWT token based authentication

# -----------------------------------------------------------------
# Health checks
# -----------------------------------------------------------------
quarkus.smallrye-health.root-path=/health
quarkus.smallrye-health.liveness-path=/health/live
quarkus.smallrye-health.readiness-path=/health/ready

# -----------------------------------------------------------------
# Metrics (Micrometer + Prometheus)
# -----------------------------------------------------------------
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.jvm.enabled=true
quarkus.micrometer.binder.system.enabled=true

# -----------------------------------------------------------------
# Logging
# -----------------------------------------------------------------
quarkus.log.level=INFO
quarkus.log.category."io.kayys.wayang".level=${LOG_LEVEL:DEBUG}
quarkus.log.category."org.hibernate.SQL".level=${LOG_SQL:OFF}
quarkus.log.console.enable=true
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.json=${LOG_JSON:false}

# -----------------------------------------------------------------
# SmallRye JWT / OIDC (Keycloak)
# -----------------------------------------------------------------
quarkus.oidc.enabled=true
quarkus.oidc.auth-server-url=${KEYCLOAK_URL:http://localhost:8180/realms/wayang}
quarkus.oidc.client-id=${OIDC_CLIENT_ID:wayang-designer}
quarkus.oidc.credentials.secret=${OIDC_CLIENT_SECRET:changeme}
quarkus.oidc.tls.verification=${OIDC_TLS_VERIFY:required}
quarkus.oidc.token.issuer=${KEYCLOAK_URL}/realms/wayang
quarkus.oidc.token.audience=wayang-designer
quarkus.smallrye-jwt.enabled=true
quarkus.smallrye-jwt.public-key.location=${JWT_PUBLIC_KEY_LOCATION:http://localhost:8180/realms/wayang/protocol/openid-connect/certs}

# -----------------------------------------------------------------
# Kafka – only outbound channel (inbound disabled as requested)
# -----------------------------------------------------------------
# Disable the inbound channel completely
mp.messaging.incoming.words-in.connector=smallrye-kafka
mp.messaging.incoming.words-in.enabled=false

# Outbound channel configuration
mp.messaging.outgoing.words-out.connector=smallrye-kafka
mp.messaging.outgoing.words-out.topic=words
mp.messaging.outgoing.words-out.key.serializer=org.apache.kafka.common.serialization.StringSerializer
mp.messaging.outgoing.words-out.value.serializer=org.apache.kafka.common.serialization.StringSerializer
mp.messaging.outgoing.words-out.bootstrap.servers=localhost:19092

# Global Kafka bootstrap (used by other potential channels)
kafka.bootstrap.servers=localhost:19092

# -----------------------------------------------------------------
# Kubernetes / OpenShift (optional – useful for dev)
# -----------------------------------------------------------------
quarkus.kubernetes.deployment-target=kubernetes
quarkus.kubernetes.replicas=2
quarkus.kubernetes.labels.app=wayang-designer
quarkus.kubernetes.labels.version=${quarkus.application.version}
quarkus.kubernetes.env.vars.DB_HOST=${DB_HOST}
quarkus.kubernetes.env.vars.DB_PORT=${DB_PORT}
quarkus.kubernetes.env.vars.DB_NAME=${DB_NAME}
quarkus.kubernetes.env.secrets.DB_USERNAME=wayang-db-credentials:username
quarkus.kubernetes.env.secrets.DB_PASSWORD=wayang-db-credentials:password
quarkus.kubernetes.env.secrets.OIDC_CLIENT_SECRET=wayang-oidc-secret:client-secret

# -----------------------------------------------------------------
# Native image build hints (if you ever build a native binary)
# -----------------------------------------------------------------
quarkus.native.additional-build-args=-H:+ReportExceptionStackTraces,-H:+AddAllCharsets,--enable-url-protocols=http,https

# -----------------------------------------------------------------
# Custom Wayang application settings
# -----------------------------------------------------------------
wayang.designer.lock-ttl=${LOCK_TTL:300}
wayang.designer.max-drafts=${MAX_DRAFTS:10}
wayang.designer.validation-timeout=${VALIDATION_TIMEOUT:30000}
wayang.designer.autosave-interval=${AUTOSAVE_INTERVAL:30000}
wayang.designer.max-nodes=${MAX_NODES:1000}
wayang.designer.max-connections=${MAX_CONNECTIONS:2000}
quarkus.debug.enabled=false
quarkus.test.jvm-debug.enabled=false

