
# Application metadata
quarkus:
  application:
    name: wayang-designer-backend
    version: 1.0.0

# HTTP Configuration
  http:
    port: 8080
    cors:
      ~: true
      origins: "*"
      methods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
      headers: "accept, authorization, content-type, x-requested-with, x-tenant-id, x-trace-id"
      access-control-max-age: 86400

# Datasource Configuration (PostgreSQL with Reactive)
  datasource:
    db-kind: postgresql
    username: ${DB_USERNAME:wayang}
    password: ${DB_PASSWORD:changeme}
    reactive:
      url: postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:wayang_designer}
      max-size: 20

# Hibernate ORM with Panache Reactive
  hibernate-orm:
    database:
      generation: update
    dialect: org.hibernate.dialect.PostgreSQLDialect
    mapping:
      format:
        global: ignore
    log:
      sql: ${LOG_SQL:false}

# Jackson Configuration
  jackson:
    write-dates-as-timestamps: true

# Redis Cache Configuration
  redis:
    hosts: redis://${REDIS_HOST:localhost}:${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    client-type: standalone
    timeout: 10s

# Security - JWT/OIDC Configuration
  oidc:
    enabled: true
    auth-server-url: ${KEYCLOAK_URL:http://localhost:8180/realms/wayang}
    client-id: ${OIDC_CLIENT_ID:wayang-designer}
    credentials:
      secret: ${OIDC_CLIENT_SECRET:changeme}
    tls:
      verification: ${OIDC_TLS_VERIFY:required}
    token:
      issuer: ${KEYCLOAK_URL}/realms/wayang
      audience: wayang-designer

# SmallRye JWT
  smallrye-jwt:
    enabled: true
    public-key:
      location: ${JWT_PUBLIC_KEY_LOCATION:http://localhost:8180/realms/wayang/protocol/openid-connect/certs}

# Multi-tenancy Configuration
  multitenancy:
    enabled: true
    tenant:
      resolver:
        type: header
        header-name: X-Tenant-Id

# REST Client Configuration
  rest-client:
    # Schema Registry Client
    schema-registry:
      url: ${SCHEMA_REGISTRY_URL:http://localhost:8081}
      scope: jakarta.inject.Singleton
      connect-timeout: 5000
      read-timeout: 10000
    
    # Version Service Client
    version-service:
      url: ${VERSION_SERVICE_URL:http://localhost:8082}
      scope: jakarta.inject.Singleton
      connect-timeout: 5000
      read-timeout: 10000
    
    # Guardrails Service Client
    guardrails-service:
      url: ${GUARDRAILS_URL:http://localhost:8083}
      scope: jakarta.inject.Singleton
      connect-timeout: 5000
      read-timeout: 15000
    
    # Plugin Manager Client
    plugin-manager:
      url: ${PLUGIN_MANAGER_URL:http://localhost:8084}
      scope: jakarta.inject.Singleton
      connect-timeout: 5000
      read-timeout: 10000

# Fault Tolerance Configuration
  fault-tolerance:
    retry:
      max-retries: 3
      delay: 500
    timeout:
      value: 10000
    circuit-breaker:
      request-volume-threshold: 10
      failure-ratio: 0.5
      delay: 10000

# OpenAPI/Swagger Configuration
  swagger-ui:
    always-include: true
    path: /swagger-ui
    theme: material
  
  smallrye-openapi:
    info-title: Wayang Designer Backend API
    info-version: ${quarkus.application.version}
    info-description: Visual AI Agent Workflow Designer Backend Service
    info-contact-name: Kayys Tech
    info-contact-url: https://kayys.tech
    security-scheme: jwt
    security-scheme-name: JWT Authentication
    security-scheme-description: JWT token-based authentication

# Observability - Metrics
  micrometer:
    enabled: true
    export:
      prometheus:
        enabled: true
        path: /metrics
    binder:
      http-server:
        enabled: true
      jvm:
        enabled: true
      system:
        enabled: true

# Observability - Health Checks
  smallrye-health:
    root-path: /health
    liveness-path: /health/live
    readiness-path: /health/ready

# Observability - OpenTelemetry
  otel:
    enabled: ${OTEL_ENABLED:true}
    exporter:
      otlp:
        endpoint: ${OTEL_ENDPOINT:http://localhost:4317}
    service:
      name: wayang-designer-backend
    traces:
      sampler:
        type: traceidratio
        arg: ${OTEL_TRACE_SAMPLE_RATE:0.1}

# Logging Configuration
  log:
    level: INFO
    category:
      "io.kayys.wayang": ${LOG_LEVEL:DEBUG}
      "org.hibernate.SQL": ${LOG_SQL:false}
    console:
      enable: true
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"
      json: ${LOG_JSON:false}

# Kubernetes/OpenShift Configuration
  kubernetes:
    deployment-target: kubernetes
    replicas: ${REPLICAS:2}
    labels:
      app: wayang-designer
      version: ${quarkus.application.version}
    env:
      vars:
        - name: DB_HOST
          value: ${DB_HOST}
        - name: DB_PORT
          value: ${DB_PORT}
        - name: DB_NAME
          value: ${DB_NAME}
      secrets:
        - name: DB_USERNAME
          secret: wayang-db-credentials
          key: username
        - name: DB_PASSWORD
          secret: wayang-db-credentials
          key: password
        - name: OIDC_CLIENT_SECRET
          secret: wayang-oidc-secret
          key: client-secret

# Native Image Configuration
  native:
    additional-build-args:
      - "-H:+ReportExceptionStackTraces"
      - "-H:+AddAllCharsets"
      - "--enable-url-protocols=http,https"

# Custom Application Configuration
wayang:
  designer:
    # Lock TTL (seconds)
    lock-ttl: ${LOCK_TTL:300}
    
    # Max drafts per user
    max-drafts: ${MAX_DRAFTS:10}
    
    # Validation timeout (ms)
    validation-timeout: ${VALIDATION_TIMEOUT:30000}
    
    # Autosave interval (ms)
    autosave-interval: ${AUTOSAVE_INTERVAL:30000}
    
    # Max nodes per workflow
    max-nodes: ${MAX_NODES:1000}
    
    # Max connections per workflow
    max-connections: ${MAX_CONNECTIONS:2000}

---
# Profile: dev (development)
"%dev":
  quarkus:
    http:
      port: 8080
    datasource:
      username: wayang
      password: dev123
      reactive:
        url: postgresql://localhost:5432/wayang_designer_dev
    redis:
      hosts: redis://localhost:6379
    log:
      level: DEBUG
      category:
        "io.kayys.wayang": DEBUG
        "org.hibernate.SQL": DEBUG
    hibernate-orm:
      database:
        generation: drop-and-create
      log:
        sql: true

---
# Profile: test (testing)
"%test":
  quarkus:
    datasource:
      reactive:
        url: postgresql://localhost:5433/wayang_designer_test
    hibernate-orm:
      database:
        generation: drop-and-create
      mapping:
        format:
          global: ignore
    jackson:
      write-dates-as-timestamps: true
    redis:
      hosts: redis://localhost:6380

---
# Profile: prod (production)
"%prod":
  quarkus:
    http:
      port: 8080
    datasource:
      username: ${DB_USERNAME}
      password: ${DB_PASSWORD}
      reactive:
        url: postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
        max-size: 50
    redis:
      hosts: redis://${REDIS_HOST}:${REDIS_PORT}
      password: ${REDIS_PASSWORD}
    log:
      level: INFO
      console:
        json: true
    hibernate-orm:
      database:
        generation: validate
      log:
        sql: false
    otel:
      enabled: true