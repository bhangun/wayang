# Kayys Workflow Modular Schemas — Production-ready

This collection contains the modular JSON Schema files (Draft 2020-12) merged into a single document for easy copy/paste. Use these as separate files in `/schema` (or keep combined). Each file is labeled with the filename header. Update `$id` URIs as required for your registry.

---

## File: workflow.schema.json (root)

```json
{
    "$id": "https://kayys.tech/schema/v1/workflow.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Kayys Workflow",
    "type": "object",
    "required": [
        "id",
        "version",
        "logic"
    ],
    "properties": {
        "id": {
            "type": "string"
        },
        "version": {
            "type": "string"
        },
        "logic": {
            "$ref": "workflow.logic.schema.json"
        },
        "ui": {
            "$ref": "workflow.ui.schema.json"
        },
        "runtime": {
            "$ref": "workflow.runtime.schema.json"
        }
    }
}
```

---

## File: workflow.logic.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/workflow.logic.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Workflow Logic Layer",
    "type": "object",
    "required": [
        "nodes",
        "connections"
    ],
    "properties": {
        "nodes": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/node"
            }
        },
        "connections": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/connection"
            }
        }
    },
    "$defs": {
        "node": {
            "type": "object",
            "required": [
                "id",
                "type"
            ],
            "properties": {
                "id": {
                    "type": "string"
                },
                "type": {
                    "type": "string"
                },
                "properties": {
                    "type": "object"
                },
                "inputs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/port"
                    }
                },
                "outputs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/port"
                    }
                },
                "rules": {
                    "$ref": "#/$defs/nodeRules"
                },
                "validation": {
                    "type": "array"
                },
                "errorHandling": {
                    "type": "object"
                },
                "observability": {
                    "type": "object"
                },
                "sla": {
                    "type": "object"
                },
                "lifecycle": {
                    "type": "object"
                }
            }
        },
        "port": {
            "type": "object",
            "required": [
                "id",
                "schema"
            ],
            "properties": {
                "id": {
                    "type": "string"
                },
                "schema": {
                    "type": "string"
                },
                "multiplicity": {
                    "type": "string",
                    "enum": [
                        "single",
                        "list",
                        "stream"
                    ],
                    "default": "single"
                },
                "sensitive": {
                    "type": "boolean",
                    "default": false
                }
            }
        },
        "connection": {
            "type": "object",
            "required": [
                "from",
                "to"
            ],
            "properties": {
                "from": {
                    "type": "string"
                },
                "to": {
                    "type": "string"
                },
                "condition": {
                    "type": "string"
                },
                "metadata": {
                    "type": "object",
                    "additionalProperties": true
                }
            }
        },
        "nodeRules": {
            "type": "object",
            "properties": {
                "canConnectTo": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "disallow": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "inputLimit": {
                    "type": "integer",
                    "minimum": 0
                },
                "outputLimit": {
                    "type": "integer",
                    "minimum": 0
                }
            }
        }
    }
}
```

---

## File: workflow.ui.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/workflow.ui.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Workflow UI Layer",
    "type": "object",
    "properties": {
        "canvas": {
            "type": "object",
            "properties": {
                "zoom": {
                    "type": "number"
                },
                "offset": {
                    "type": "object",
                    "properties": {
                        "x": {
                            "type": "number"
                        },
                        "y": {
                            "type": "number"
                        }
                    }
                },
                "background": {
                    "type": "string"
                },
                "snapToGrid": {
                    "type": "boolean"
                }
            }
        },
        "nodes": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/uiNode"
            }
        },
        "connections": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/uiConnection"
            }
        }
    },
    "$defs": {
        "uiNode": {
            "type": "object",
            "required": [
                "ref",
                "position"
            ],
            "properties": {
                "ref": {
                    "type": "string"
                },
                "position": {
                    "type": "object",
                    "properties": {
                        "x": {
                            "type": "number"
                        },
                        "y": {
                            "type": "number"
                        }
                    }
                },
                "size": {
                    "type": "object",
                    "properties": {
                        "width": {
                            "type": "number"
                        },
                        "height": {
                            "type": "number"
                        }
                    }
                },
                "icon": {
                    "type": "string"
                },
                "color": {
                    "type": "string"
                },
                "shape": {
                    "type": "string"
                },
                "collapsed": {
                    "type": "boolean"
                },
                "zIndex": {
                    "type": "integer"
                },
                "themeVariant": {
                    "type": "string"
                }
            }
        },
        "uiConnection": {
            "type": "object",
            "properties": {
                "ref": {
                    "type": "string"
                },
                "color": {
                    "type": "string"
                },
                "pathStyle": {
                    "type": "string"
                }
            }
        }
    }
}
```

---

## File: workflow.runtime.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/workflow.runtime.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Workflow Runtime Layer",
    "type": "object",
    "properties": {
        "executedNodes": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/executionEntry"
            }
        },
        "logs": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "metrics": {
            "type": "object",
            "additionalProperties": true
        }
    },
    "$defs": {
        "executionEntry": {
            "type": "object",
            "properties": {
                "ref": {
                    "type": "string"
                },
                "timestamp": {
                    "type": "integer"
                },
                "latencyMs": {
                    "type": "number"
                },
                "tokensUsed": {
                    "type": "integer"
                },
                "costUsd": {
                    "type": "number"
                },
                "status": {
                    "type": "string"
                },
                "outputPreview": {
                    "type": "string"
                }
            }
        }
    }
}
```

---

## File: node.base.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/node.base.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Base Node",
    "type": "object",
    "required": [
        "id",
        "type"
    ],
    "properties": {
        "id": {
            "type": "string"
        },
        "type": {
            "type": "string"
        },
        "properties": {
            "type": "object"
        },
        "inputs": {
            "type": "array"
        },
        "outputs": {
            "type": "array"
        },
        "rules": {
            "type": "object"
        },
        "validation": {
            "type": "array"
        },
        "errorHandling": {
            "type": "object"
        },
        "observability": {
            "type": "object"
        },
        "sla": {
            "type": "object"
        },
        "lifecycle": {
            "type": "object"
        }
    }
}
```

---

## File: agent.llm.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/agent.llm.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Agent LLM Node",
    "allOf": [
        {
            "$ref": "node.base.schema.json"
        },
        {
            "type": "object",
            "properties": {
                "properties": {
                    "type": "object",
                    "required": [
                        "model"
                    ],
                    "properties": {
                        "model": {
                            "type": "object",
                            "required": [
                                "provider",
                                "name"
                            ],
                            "properties": {
                                "provider": {
                                    "type": "string"
                                },
                                "name": {
                                    "type": "string"
                                },
                                "temperature": {
                                    "type": "number"
                                },
                                "maxTokens": {
                                    "type": "integer"
                                }
                            }
                        },
                        "memory": {
                            "type": "object",
                            "properties": {
                                "enabled": {
                                    "type": "boolean"
                                },
                                "vectorStore": {
                                    "type": "string"
                                }
                            }
                        },
                        "tools": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        }
    ]
}
```

---

## File: memory.vector.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/memory.vector.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Vector Memory Node",
    "allOf": [
        {
            "$ref": "node.base.schema.json"
        },
        {
            "type": "object",
            "properties": {
                "properties": {
                    "type": "object",
                    "required": [
                        "engine",
                        "collection"
                    ],
                    "properties": {
                        "engine": {
                            "type": "string"
                        },
                        "collection": {
                            "type": "string"
                        },
                        "dimension": {
                            "type": "integer"
                        },
                        "topK": {
                            "type": "integer"
                        }
                    }
                }
            }
        }
    ]
}
```

---

## File: start.websocket.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/start.websocket.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "WebSocket Start Node",
    "allOf": [
        {
            "$ref": "node.base.schema.json"
        },
        {
            "type": "object",
            "properties": {
                "properties": {
                    "type": "object",
                    "required": [
                        "channel"
                    ],
                    "properties": {
                        "channel": {
                            "type": "string"
                        },
                        "authRequired": {
                            "type": "boolean"
                        }
                    }
                }
            }
        }
    ]
}
```

---

## File: concerns/Error.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/concerns/error.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "ErrorPayload",
    "type": "object",
    "required": [
        "code",
        "message",
        "timestamp"
    ],
    "properties": {
        "code": {
            "type": "string"
        },
        "type": {
            "type": "string",
            "enum": [
                "ToolError",
                "LLMError",
                "NetworkError",
                "ValidationError",
                "Timeout",
                "PluginLoadError",
                "SecurityError",
                "CircuitOpen",
                "Unknown"
            ]
        },
        "message": {
            "type": "string"
        },
        "details": {
            "type": "object",
            "additionalProperties": true
        },
        "retryable": {
            "type": "boolean"
        },
        "severity": {
            "type": "string",
            "enum": [
                "DEBUG",
                "INFO",
                "WARN",
                "ERROR",
                "CRITICAL"
            ],
            "default": "ERROR"
        },
        "origin": {
            "type": "object",
            "properties": {
                "nodeId": {
                    "type": "string"
                },
                "nodeType": {
                    "type": "string"
                },
                "runId": {
                    "type": "string",
                    "format": "uuid"
                }
            }
        },
        "attempt": {
            "type": "integer",
            "minimum": 0
        },
        "maxAttempts": {
            "type": "integer",
            "minimum": 0
        },
        "timestamp": {
            "type": "string",
            "format": "date-time"
        },
        "provenanceRef": {
            "type": "string",
            "format": "uuid"
        },
        "suggestedAction": {
            "type": "string",
            "enum": [
                "retry",
                "fallback",
                "escalate",
                "human_review",
                "abort",
                "ignore"
            ]
        }
    }
}
```

---

## File: concerns/ErrorHandlingConfig.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/concerns/errorHandlingConfig.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "ErrorHandlingConfig",
    "type": "object",
    "properties": {
        "retryPolicy": {
            "type": "object",
            "properties": {
                "maxAttempts": {
                    "type": "integer",
                    "minimum": 0,
                    "default": 3
                },
                "initialDelayMs": {
                    "type": "integer",
                    "default": 200
                },
                "maxDelayMs": {
                    "type": "integer",
                    "default": 30000
                },
                "backoff": {
                    "type": "string",
                    "enum": [
                        "fixed",
                        "exponential",
                        "linear"
                    ],
                    "default": "exponential"
                },
                "jitter": {
                    "type": "boolean",
                    "default": true
                },
                "retryOn": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "fallback": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "node",
                        "static",
                        "none"
                    ],
                    "default": "none"
                },
                "nodeId": {
                    "type": "string"
                },
                "staticResponse": {
                    "type": [
                        "object",
                        "string"
                    ]
                }
            }
        },
        "circuitBreaker": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": false
                },
                "failureThreshold": {
                    "type": "integer",
                    "default": 5
                },
                "successThreshold": {
                    "type": "integer",
                    "default": 2
                },
                "timeoutMs": {
                    "type": "integer",
                    "default": 60000
                },
                "windowMs": {
                    "type": "integer",
                    "default": 600000
                }
            }
        },
        "escalation": {
            "type": "object",
            "properties": {
                "onSeverityAtLeast": {
                    "type": "string",
                    "enum": [
                        "WARN",
                        "ERROR",
                        "CRITICAL"
                    ],
                    "default": "ERROR"
                },
                "notify": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "humanReview": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": false
                },
                "thresholdSeverity": {
                    "type": "string",
                    "enum": [
                        "WARN",
                        "ERROR",
                        "CRITICAL"
                    ],
                    "default": "CRITICAL"
                },
                "reviewQueue": {
                    "type": "string"
                }
            }
        }
    }
}
```

---

## File: concerns/validation.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/concerns/validation.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "ValidationRule",
    "type": "object",
    "properties": {
        "id": {
            "type": "string"
        },
        "description": {
            "type": "string"
        },
        "level": {
            "type": "string",
            "enum": [
                "error",
                "warning",
                "info"
            ],
            "default": "error"
        },
        "jsonSchema": {
            "type": [
                "object",
                "string"
            ]
        },
        "cel": {
            "type": "string"
        },
        "customValidator": {
            "type": "object",
            "properties": {
                "functionRef": {
                    "type": "string"
                },
                "timeoutMs": {
                    "type": "integer",
                    "default": 3000
                }
            }
        },
        "onFailure": {
            "type": "object",
            "properties": {
                "action": {
                    "type": "string",
                    "enum": [
                        "reject",
                        "sanitize",
                        "coerce",
                        "log",
                        "warn"
                    ],
                    "default": "reject"
                },
                "message": {
                    "type": "string"
                },
                "fallback": {}
            }
        }
    }
}
```

---

## File: concerns/observability.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/concerns/observability.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "ObservabilityConfig",
    "type": "object",
    "properties": {
        "tracing": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": true
                },
                "sampleRate": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0.1
                },
                "propagateTraceContext": {
                    "type": "boolean",
                    "default": true
                },
                "traceHeaders": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "metrics": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": true
                },
                "metricsList": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string"
                            },
                            "type": {
                                "type": "string",
                                "enum": [
                                    "counter",
                                    "gauge",
                                    "histogram",
                                    "summary"
                                ]
                            },
                            "description": {
                                "type": "string"
                            },
                            "labels": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "pushIntervalSec": {
                    "type": "integer",
                    "default": 15
                }
            }
        },
        "logs": {
            "type": "object",
            "properties": {
                "level": {
                    "type": "string",
                    "enum": [
                        "DEBUG",
                        "INFO",
                        "WARN",
                        "ERROR"
                    ],
                    "default": "INFO"
                },
                "structured": {
                    "type": "boolean",
                    "default": true
                },
                "sampleRate": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 1.0
                }
            }
        },
        "events": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": true
                },
                "emitOn": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "provenance": {
            "type": "object",
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": true
                },
                "collectInputs": {
                    "type": "boolean",
                    "default": false
                },
                "collectOutputs": {
                    "type": "boolean",
                    "default": false
                },
                "retainDays": {
                    "type": "integer",
                    "default": 30
                }
            }
        }
    }
}
```

---

## File: concerns/sla.schema.json

```json
{
    "$id": "https://kayys.tech/schema/v1/concerns/sla.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "SLAConfig",
    "type": "object",
    "properties": {
        "slo": {
            "type": "object",
            "properties": {
                "p95LatencyMs": {
                    "type": "integer"
                },
                "availabilityPct": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 100
                }
            }
        },
        "rateLimit": {
            "type": "object",
            "properties": {
                "requestsPerSecond": {
                    "type": "number"
                },
                "burst": {
                    "type": "integer"
                }
            }
        },
        "quotas": {
            "type": "object",
            "properties": {
                "monthlyTokens": {
                    "type": "integer"
                },
                "monthlyInvocations": {
                    "type": "integer"
                }
            }
        },
        "alerts": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "expr": {
                        "type": "string"
                    },
                    "for": {
                        "type": "string"
                    },
                    "severity": {
                        "type": "string",
                        "enum": [
                            "warning",
                            "critical"
                        ]
                    },
                    "notify": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            }
        }
    }
}
```

---

### Notes

* Place each file into `/schema/` and wire `$ref` URIs as needed for your validator runtime.
* These files are production-focused: error model, validation pipeline, telemetry, SLOs, lifecycle hooks, and node inheritance are all included.

If you want, I can:

* Export each file as separate downloadable files (zip)
* Generate TypeScript interfaces for all schemas
* Generate server-side validation/engine pseudocode that enforces errorHandling → validation → observability flow

Which would you like next?
