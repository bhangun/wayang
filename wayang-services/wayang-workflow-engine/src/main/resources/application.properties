# =============================================================================
# Quarkus Application Configuration
# =============================================================================
quarkus.application.name=ai-agent-runtime

# --- HTTP Configuration ---
quarkus.http.port=7001
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=*
quarkus.http.limits.max-body-size=50M

# --- gRPC Configuration ---
quarkus.grpc.server.port=9090
quarkus.grpc.server.test-port=9091

# --- Security & OIDC ---
quarkus.oidc.auth-server-url=${KEYCLOAK_URL:http://localhost:8081/realms/wayang}
quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID:wayang-workflow-engine}
quarkus.oidc.credentials.secret=${KEYCLOAK_SECRET:secret}
quarkus.oidc.application-type=service

# Keycloak Dev Services (Auto-starts Keycloak for local dev)
quarkus.keycloak.devservices.enabled=true
quarkus.keycloak.devservices.realm-name=wayang
quarkus.keycloak.devservices.users.alice=alice
quarkus.keycloak.devservices.users.bob=bob
quarkus.keycloak.devservices.roles.alice=user,admin
quarkus.keycloak.devservices.roles.bob=user

# --- Basic Authentication (Dev/Test) ---
quarkus.security.users.embedded.enabled=true
quarkus.security.users.embedded.plain-text=true
quarkus.security.users.embedded.users.admin=admin
quarkus.security.users.embedded.roles.admin=admin,user
quarkus.security.users.embedded.users.user=user
quarkus.security.users.embedded.roles.user=user

# --- Logging ---
quarkus.log.level=INFO
quarkus.log.category."io.quarkus.ai.agent".level=DEBUG
quarkus.log.category."io.vertx".level=WARN
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n

# =============================================================================
# Database Configuration
# =============================================================================
# Global default credentials to prevent 'sa' user errors
quarkus.datasource.username=${POSTGRES_USER:quarkus}
quarkus.datasource.password=${POSTGRES_PASSWORD:quarkus}
quarkus.datasource.db-kind=postgresql



# --- Dev Services (Testcontainers) ---
quarkus.datasource.devservices.enabled=true
quarkus.datasource.devservices.image-name=postgres:14
quarkus.datasource.devservices.username=quarkus
quarkus.datasource.devservices.password=quarkus

# --- JDBC & Reactive Datasource ---
quarkus.datasource.jdbc.max-size=20
quarkus.datasource.jdbc.min-size=5
quarkus.datasource.reactive.max-size=20

# %dev profile: Connect to localhost (Docker Compose)
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5433/${POSTGRES_DB:wayang}
%dev.quarkus.datasource.reactive.url=postgresql://localhost:5433/${POSTGRES_DB:wayang}

# %prod profile: Expect standard K8s/Cloud env vars
%prod.quarkus.datasource.jdbc.url=${DATABASE_URL:}
%prod.quarkus.datasource.reactive.url=${DATABASE_REACTIVE_URL:}
# Fallback if specific URL vars aren't set but host/port are:
# %prod.quarkus.datasource.reactive.url=postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:wayang}

# Disable Dev Services implies we handle the DB ourselves (via docker-compose)
quarkus.datasource.devservices.enabled=false

# %test profile: re-enable Dev Services for isolated testing
%test.quarkus.datasource.devservices.enabled=true
%test.quarkus.datasource.devservices.image-name=postgres:14
%test.quarkus.datasource.devservices.username=quarkus
%test.quarkus.datasource.devservices.password=quarkus

# --- Health Check ---
quarkus.datasource.health.enabled=true

# =============================================================================
# Hibernate Reactive
# =============================================================================
# Production defaults
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.sql-load-script=no-file
quarkus.hibernate-orm.log.sql=false
quarkus.hibernate-orm.mapping.format.global=ignore

# Development overrides (activated by %dev profile)
%dev.quarkus.hibernate-orm.database.generation=drop-and-create
%dev.quarkus.hibernate-orm.sql-load-script=import.sql
%dev.quarkus.hibernate-orm.log.sql=true

# =============================================================================
# Redis Configuration
# =============================================================================
quarkus.redis.devservices.enabled=false
quarkus.redis.hosts=redis://localhost:6380
quarkus.redis.password=${REDIS_PASSWORD:}
quarkus.redis.timeout=10s
quarkus.redis.max-pool-size=20

# =============================================================================
# MinIO Configuration
# =============================================================================
quarkus.minio.devservices.enabled=false
quarkus.minio.url=${MINIO_URL:http://localhost:9001}
quarkus.minio.access-key=${MINIO_ACCESS_KEY:minioadmin}
quarkus.minio.secret-key=${MINIO_SECRET_KEY:minioadmin}

# =============================================================================
# Kafka & Reactive Messaging
# =============================================================================
quarkus.kafka.devservices.enabled=false


# =============================================================================
# Observability
# =============================================================================
# --- Monitoring & Metrics ---
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics

# --- OpenTelemetry Tracing ---
quarkus.otel.enabled=${TRACING_ENABLED:false}
quarkus.otel.exporter.otlp.endpoint=${OTEL_ENDPOINT:http://localhost:4317}

# --- Health & Scheduler ---
quarkus.smallrye-health.enabled=true
quarkus.scheduler.enabled=true

# --- Dev UI ---
quarkus.dev-ui.enabled=${DEV_UI_ENABLED:true}

# =============================================================================
# AI Agent Runtime Configuration
# =============================================================================
# --- Workflow Execution ---
ai-agent.execution.max-concurrent-workflows=${MAX_CONCURRENT_WORKFLOWS:100}
ai-agent.execution.workflow-timeout-seconds=${WORKFLOW_TIMEOUT:300}
ai-agent.execution.max-retry-attempts=3
ai-agent.execution.retry-backoff-ms=1000

# --- Node Execution ---
ai-agent.node.default-timeout-seconds=60
ai-agent.node.parallel-max-concurrency=10

# --- LLM Configuration ---
ai-agent.llm.default-provider=openai
ai-agent.llm.timeout-seconds=60
ai-agent.llm.max-retries=3
ai-agent.llm.rate-limit-per-minute=60

# --- LLM Providers ---
ai-agent.llm.providers.openai.api-key=${OPENAI_API_KEY:}
ai-agent.llm.providers.openai.base-url=https://api.openai.com/v1

ai-agent.llm.providers.anthropic.api-key=${ANTHROPIC_API_KEY:}
ai-agent.llm.providers.anthropic.base-url=https://api.anthropic.com/v1

ai-agent.llm.providers.google.api-key=${GOOGLE_API_KEY:}
ai-agent.llm.providers.google.base-url=https://generativelanguage.googleapis.com/v1beta

ai-agent.llm.providers.cohere.api-key=${COHERE_API_KEY:}
ai-agent.llm.providers.cohere.base-url=https://api.cohere.ai/v1

ai-agent.llm.providers.azure.api-key=${AZURE_OPENAI_KEY:}
ai-agent.llm.providers.azure.endpoint=${AZURE_OPENAI_ENDPOINT:}

ai-agent.llm.providers.aws.region=${AWS_REGION:us-east-1}
ai-agent.llm.providers.aws.access-key=${AWS_ACCESS_KEY:}
ai-agent.llm.providers.aws.secret-key=${AWS_SECRET_KEY:}

ai-agent.llm.providers.ollama.base-url=${OLLAMA_URL:http://localhost:11434}

# --- Memory Configuration ---
ai-agent.memory.default-backend=in-memory
ai-agent.memory.max-history-size=100
ai-agent.memory.cleanup-interval-minutes=60

# --- Tool Configuration ---
ai-agent.tool.default-timeout-seconds=30
ai-agent.tool.max-retries=3
ai-agent.tool.rate-limit-enabled=true

# --- Security ---
ai-agent.security.api-key-header=X-API-Key
ai-agent.security.api-keys=${API_KEYS:}
ai-agent.security.encryption-key=${ENCRYPTION_KEY:}

# --- Storage ---
ai-agent.storage.type=${STORAGE_TYPE:database}
ai-agent.storage.file-path=${STORAGE_PATH:./data}
ai-agent.storage.s3-bucket=${S3_BUCKET:}
ai-agent.storage.minio.url=${quarkus.minio.url}
ai-agent.storage.minio.access-key=${quarkus.minio.access-key}
ai-agent.storage.minio.secret-key=${quarkus.minio.secret-key}

# --- Backup ---
backup.storage.provider=${BACKUP_PROVIDER:local}
backup.storage.base.path=${BACKUP_PATH:./backups}
backup.storage.minio.bucket=${MINIO_BUCKET:workflows-backup}

# --- Orchestration ---
backup.orchestration.max-iterations=10
backup.orchestration.reflection-max=3
backup.orchestration.hierarchical-max-workers=5

# --- Monitoring ---
backup.monitoring.enabled=true
backup.monitoring.log-executions=true
backup.monitoring.track-metrics=true
backup.monitoring.alert-on-failures=true

# =============================================================================
# Wayang Specific
# =============================================================================
wayang.workflow.distributed-cache.enabled=${DISTRIBUTED_CACHE_ENABLED:false}